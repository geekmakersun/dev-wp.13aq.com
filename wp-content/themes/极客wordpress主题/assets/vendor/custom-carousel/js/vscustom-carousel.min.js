(function ($) {
  "use strict";

  // 仅当slick插件已加载时执行
  if (typeof $.fn.slick !== 'undefined') {
    // 主轮播初始化
    $('.vs-carousel').each(function () {
      var vsSlide = $(this);
      
      // 确保元素存在
      if (!vsSlide.length) {
        return;
      }

      // 收集数据属性，提供默认值
      var data = {
        'dots': vsSlide.data('dots') || false,
        'fade': vsSlide.data('fade') || false,
        'arrows': vsSlide.data('arrows') || false,
        'speed': vsSlide.data('speed') || 1000,
        'asnavfor': vsSlide.data('asnavfor') || false,
        'autoplay': vsSlide.data('autoplay') !== false ? false : false,
        'infinite': vsSlide.data('infinite') !== false ? true : false,
        'slide-show': vsSlide.data('slide-show') || 1,
        'adaptive-height': vsSlide.data('adaptive-height') || false,
        'center-mode': vsSlide.data('center-mode') || false,
        'autoplay-speed': vsSlide.data('autoplay-speed') || 8000,
        'center-padding': vsSlide.data('center-padding') || '0',
        'focuson-select': vsSlide.data('focuson-select') || false,
        'pauseon-focus': vsSlide.data('pauseon-focus') || false,
        'pauseon-hover': vsSlide.data('pauseon-hover') || false,
        'variable-width': vsSlide.data('variable-width') || false,
        'vertical': vsSlide.data('vertical') || false,
        'prev-arrow': vsSlide.data('prev-arrow') || 'far fa-chevron-left',
        'next-arrow': vsSlide.data('next-arrow') || 'far fa-chevron-right',
        'rows': vsSlide.data('rows') || 1
      };

      // 自定义箭头按钮
      var prevButton = '<button type="button" class="slick-prev"><i class="' + data['prev-arrow'] + '"></i></button>',
          nextButton = '<button type="button" class="slick-next"><i class="' + data['next-arrow'] + '"></i></button>';

      // 自定义箭头按钮点击事件
      $('[data-slick-next]').each(function () {
        $(this).on('click', function (e) {
          e.preventDefault();
          var target = $($(this).data('slick-next'));
          if (target.length && typeof target.slick === 'function') {
            target.slick('slickNext');
          }
        });
      });
      
      $('[data-slick-prev]').each(function () {
        $(this).on('click', function (e) {
          e.preventDefault();
          var target = $($(this).data('slick-prev'));
          if (target.length && typeof target.slick === 'function') {
            target.slick('slickPrev');
          }
        });
      });

      // 检查并添加箭头包装器
      if (data.arrows === true) {
        var container = vsSlide.closest('.container');
        if (container.length && !vsSlide.closest('.arrow-wrap').length) {
          container.parent().addClass('arrow-wrap');
        }
      }

      try {
        // 初始化slick carousel，禁用ADA功能以避免null错误
        vsSlide.slick({
          dots: data.dots,
          fade: data.fade,
          arrows: data.arrows,
          speed: data.speed,
          asNavFor: data.asnavfor,
          autoplay: data.autoplay,
          infinite: data.infinite,
          slidesToShow: data['slide-show'],
          adaptiveHeight: data['adaptive-height'],
          centerMode: data['center-mode'],
          autoplaySpeed: data['autoplay-speed'],
          centerPadding: data['center-padding'],
          focusOnSelect: data['focuson-select'],
          pauseOnFocus: data['pauseon-focus'],
          pauseOnHover: data['pauseon-hover'],
          variableWidth: data['variable-width'],
          vertical: data.vertical,
          prevArrow: prevButton,
          nextArrow: nextButton,
          rtl: $('html').attr('dir') === 'rtl',
          rows: data.rows,
          // 禁用ADA功能，避免null错误
          accessibility: false,
          responsive: [
            {
              breakpoint: 1600,
              settings: {
                arrows: vsSlide.data('xl-arrows') || false,
                dots: vsSlide.data('xl-dots') || false,
                slidesToShow: vsSlide.data('xl-slide-show') || data['slide-show'],
                centerMode: vsSlide.data('xl-center-mode') || false,
                centerPadding: 0
              }
            },
            {
              breakpoint: 1400,
              settings: {
                arrows: vsSlide.data('ml-arrows') || false,
                dots: vsSlide.data('ml-dots') || false,
                slidesToShow: vsSlide.data('ml-slide-show') || data['slide-show'],
                centerMode: vsSlide.data('ml-center-mode') || false,
                centerPadding: 0
              }
            },
            {
              breakpoint: 1200,
              settings: {
                arrows: vsSlide.data('lg-arrows') || false,
                dots: vsSlide.data('lg-dots') || false,
                slidesToShow: vsSlide.data('lg-slide-show') || data['slide-show'],
                centerMode: vsSlide.data('lg-center-mode') || false,
                centerPadding: 0
              }
            },
            {
              breakpoint: 992,
              settings: {
                arrows: vsSlide.data('md-arrows') || false,
                dots: vsSlide.data('md-dots') || false,
                slidesToShow: vsSlide.data('md-slide-show') || 2,
                centerMode: vsSlide.data('md-center-mode') || false,
                centerPadding: 0
              }
            },
            {
              breakpoint: 767,
              settings: {
                arrows: vsSlide.data('sm-arrows') || false,
                dots: vsSlide.data('sm-dots') || false,
                slidesToShow: vsSlide.data('sm-slide-show') || 2,
                centerMode: vsSlide.data('sm-center-mode') || false,
                centerPadding: 0
              }
            },
            {
              breakpoint: 576,
              settings: {
                arrows: vsSlide.data('xs-arrows') || false,
                dots: vsSlide.data('xs-dots') || false,
                slidesToShow: vsSlide.data('xs-slide-show') || 2,
                centerMode: vsSlide.data('xs-center-mode') || false,
                centerPadding: 0
              }
            }
          ]
        });
      } catch (e) {
        // 捕获并忽略错误，避免影响页面其他功能
        console.error('Slick carousel初始化错误:', e);
      }
    });
  }

})(jQuery);